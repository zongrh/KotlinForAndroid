#### 目录介绍
- 01.用了HTTPS会被抓包吗？是如何操作的？既然HTTPS不能防抓包，那HTTPS有什么意义？
- 02.为什么需要CA认证机构颁发证书？证书包含什么信息？证书的合法性依据是什么？
- 03.浏览器如何验证证书的合法性？证书是公开的，如何避免这种证书冒用的情况？只有认证机构可以生成证书吗？




### 01.用了HTTPS会被抓包吗？是如何操作的？既然HTTPS不能防抓包，那HTTPS有什么意义？
- 用了HTTPS会被抓包吗？
    - HTTPS 的数据是加密的，常规下抓包工具代理请求后抓到的包内容是加密状态，无法直接查看。但是，正如前文所说，浏览器只会提示安全风险，如果用户授权仍然可以继续访问网站，完成请求。
    - 因此，只要客户端是我们自己的终端，我们授权的情况下，便可以组建中间人网络，而抓包工具便是作为中间人的代理。
    - 通常HTTPS抓包工具的使用方法是会生成一个证书，用户需要手动把证书安装到客户端中，然后终端发起的所有请求通过该证书完成与抓包工具的交互，然后抓包工具再转发请求到服务器，最后把服务器返回的结果在控制台输出后再返回给终端，从而完成整个请求的闭环。
- 既然HTTPS不能防抓包，那HTTPS有什么意义？
    - HTTPS可以防止用户在不知情的情况下通信链路被监听，对于主动授信的抓包操作是不提供防护的，因为这个场景用户是已经对风险知情。
    - 要防止被抓包，需要采用应用级的安全防护，例如采用私有的对称加密，同时做好移动端的防反编译加固，防止本地算法被破解。
  

### 02.为什么需要CA认证机构颁发证书？证书包含什么信息？证书的合法性依据是什么？
- 为什么需要CA认证机构颁发证书？
    - HTTP协议被认为不安全是因为传输过程容易被监听者勾线监听、伪造服务器，而HTTPS协议主要解决的便是网络传输的安全性问题。首先我们假设不存在认证机构，任何人都可以制作证书，这带来的安全风险便是经典的 “中间人攻击” 问题。 
- 证书包含什么信息？
    - 颁发机构信息+公钥+公司信息+域名+有效期+指纹
- 证书的合法性依据是什么？
    - 首先，权威机构是要有认证的，不是随便一个机构都有资格颁发证书，不然也不叫做权威机构。
    - 另外，证书的可信性基于信任制，权威机构需要对其颁发的证书进行信用背书，只要是权威机构生成的证书，我们就认为是合法的。所以权威机构会对申请者的信息进行审核，不同等级的权威机构对审核的要求也不一样，于是证书也分为免费的、便宜的和贵的。



### 03.浏览器如何验证证书的合法性？证书是公开的，如何避免这种证书冒用的情况？只有认证机构可以生成证书吗？
- 浏览器如何验证证书的合法性？
    - 验证域名和有效期等信息是否正确+判断证书来源是否合法+判断证书是否被篡改+判断证书是否已吊销
- 浏览器发起 HTTPS 请求时，服务器会返回网站的 SSL 证书，浏览器需要对证书做以下验证：
    - 1.验证域名、有效期等信息是否正确。证书上都有包含这些信息，比较容易完成验证；
    - 2.判断证书来源是否合法。每份签发证书都可以根据验证链查找到对应的根证书，操作系统、浏览器会在本地存储权威机构的根证书，利用本地根证书可以对对应机构签发证书完成来源验证;
    - 3.判断证书是否被篡改。需要与 CA 服务器进行校验；
    - 4.判断证书是否已吊销。通过CRL（Certificate Revocation List 证书注销列表）和 OCSP（Online Certificate Status Protocol 在线证书状态协议）实现，其中 OCSP 可用于第3步中以减少与 CA 服务器的交互，提高验证效率
    - 以上所有步骤都满足的情况下浏览器才认为证书是合法的。
- 证书是公开的，如何避免这种证书冒用的情况？
    - 既然证书是公开的，如果要发起中间人攻击，我在官网上下载一份证书作为我的服务器证书，那客户端肯定会认同这个证书是合法的，如何避免这种证书冒用的情况？
    - 其实这就是非加密对称中公私钥的用处，虽然中间人可以得到证书，但私钥是无法获取的，一份公钥是不可能推算出其对应的私钥，中间人即使拿到证书也无法伪装成合法服务端，因为无法对客户端传入的加密数据进行解密。
- 只有认证机构可以生成证书吗？
    - 如果需要浏览器不提示安全风险，那只能使用认证机构签发的证书。但浏览器通常只是提示安全风险，并不限制网站不能访问，所以从技术上谁都可以生成证书，只要有证书就可以完成网站的HTTPS 传输。例如早期的 12306 采用的便是手动安装私有证书的形式实现 HTTPS 访问。 















